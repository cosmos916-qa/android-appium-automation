package com.example.appium_android_automation.reporting;

import com.google.api.services.sheets.v4.Sheets;
import com.google.api.services.sheets.v4.model.ValueRange;
import java.util.List;

/**
 * í…ŒìŠ¤íŠ¸ ì„±ì í‘œ ìë™ ê¸°ì… ë„êµ¬ (êµ¬ê¸€ ì‹œíŠ¸ ì‹¤ì‹œê°„ ì—°ë™)
 *
 * ì´ í´ë˜ìŠ¤ëŠ” í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ìë™ìœ¼ë¡œ ê¸°ë¡í•˜ëŠ” "ë””ì§€í„¸ ì±„ì  ì¡°êµ"ì…ë‹ˆë‹¤.
 * ë§ˆì¹˜ ì‹œí—˜ ì±„ì  í›„ ì„±ì í‘œì— ì ìˆ˜ë¥¼ ì ëŠ” ê²ƒì²˜ëŸ¼,
 * ê° í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì˜ Pass/Fail/Block ê²°ê³¼ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‹œíŠ¸ì— ê¸°ë¡í•©ë‹ˆë‹¤.
 *
 * ğŸ“Š ì™œ êµ¬ê¸€ ì‹œíŠ¸ë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”?
 *
 * **ê¸°ì¡´ ë°©ì‹ (ì½˜ì†” ë¡œê·¸ë§Œ ì‚¬ìš©):**
 * - QA: "TC03ì´ ì‹¤íŒ¨í–ˆëŠ”ë° ì–¸ì œ ì‹¤íŒ¨í•œ ê±°ì£ ?"
 * - ê°œë°œì: "ë¡œê·¸ íŒŒì¼ ì–´ë”” ìˆì–´ìš”?"
 * - PM: "ì „ì²´ í…ŒìŠ¤íŠ¸ ì§„í–‰ë¥ ì´ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?"
 * â†’ ì •ë³´ ê³µìœ ê°€ ì–´ë µê³  ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë¶ˆê°€ëŠ¥
 *
 * **êµ¬ê¸€ ì‹œíŠ¸ í™œìš©:**
 * - í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì‹¤ì‹œê°„ìœ¼ë¡œ ê²°ê³¼ í™•ì¸ ê°€ëŠ¥
 * - íŒ€ì› ëª¨ë‘ê°€ ë™ì‹œì— ê°™ì€ ì‹œíŠ¸ ì¡°íšŒ (ê¶Œí•œë§Œ ìˆìœ¼ë©´)
 * - íˆìŠ¤í† ë¦¬ ìë™ ë³´ì¡´ (ì–¸ì œ ì–´ë–¤ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì¶”ì )
 * - ì°¨íŠ¸ë‚˜ í†µê³„ ìë™ ìƒì„± ê°€ëŠ¥
 *
 * ğŸ¯ í•µì‹¬ ê¸°ëŠ¥: ë™ì  ì…€ ì£¼ì†Œ ê³„ì‚°
 *
 * **ê³¼ê±° ë°©ì‹ (í•˜ë“œì½”ë”©):**
 * ```java
 * writeTC01Result("Pass"); // G3ì— ê¸°ë¡
 * writeTC02Result("Fail"); // G4ì— ê¸°ë¡
 * writeTC03Result("Pass"); // G5ì— ê¸°ë¡
 * // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ 100ê°œë©´ ë©”ì„œë“œë„ 100ê°œ í•„ìš”...
 * ```
 *
 * **í˜„ì¬ ë°©ì‹ (ë™ì  ê³„ì‚°):**
 * ```java
 * writeTCResult(1, "Pass");  // TC ë²ˆí˜¸ë§Œ ì£¼ë©´ ìë™ìœ¼ë¡œ G3 ê³„ì‚°
 * writeTCResult(2, "Fail");  // ìë™ìœ¼ë¡œ G4 ê³„ì‚°
 * writeTCResult(99, "Pass"); // ìë™ìœ¼ë¡œ G101 ê³„ì‚°
 * // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ëª‡ ê°œë“  í•˜ë‚˜ì˜ ë©”ì„œë“œë¡œ ì²˜ë¦¬!
 * ```
 *
 * ğŸ“ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ êµ¬ì¡° ì´í•´:
 * ```
 * A    B         C          D         E        F      G
 * â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚ 1  â”‚ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì œëª© í–‰)                          â”‚ â† ì œëª©
 * â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ 2  â”‚ TC No  â”‚ í…ŒìŠ¤íŠ¸ëª…  â”‚ ìš°ì„ ìˆœìœ„ â”‚ ë‹´ë‹¹ì â”‚ ìƒíƒœ â”‚ Result â”‚ â† ì»¬ëŸ¼ í—¤ë”
 * â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ 3  â”‚ TC01   â”‚ ì•± ì‹œì‘   â”‚ High    â”‚ ë°•ì„±ìˆ˜ â”‚ ì§„í–‰ â”‚ Pass   â”‚ â† ì‹¤ì œ ë°ì´í„° ì‹œì‘
 * â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚ 4  â”‚ TC02   â”‚ ë¡œê³  ê²€ì¦ â”‚ High    â”‚ ë°•ì„±ìˆ˜ â”‚ ì§„í–‰ â”‚ Fail   â”‚
 * â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 * ```
 *
 * ğŸ’¡ ì…€ ì£¼ì†Œ ê³„ì‚° ê³µì‹:
 * - TC01 (tcNo=1) â†’ 1 + 2 = 3í–‰ â†’ G3
 * - TC02 (tcNo=2) â†’ 2 + 2 = 4í–‰ â†’ G4
 * - TC99 (tcNo=99) â†’ 99 + 2 = 101í–‰ â†’ G101
 *
 */
public class ChecklistReporter {

    /**
     * êµ¬ê¸€ ì‹œíŠ¸ API ì„œë¹„ìŠ¤ ê°ì²´ (ì‹¤ì œ ì‹œíŠ¸ì— ì ‘ê·¼í•˜ëŠ” ë„êµ¬)
     */
    private final Sheets sheets;

    /**
     * ëŒ€ìƒ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì˜ ê³ ìœ  ì‹ë³„ ë²ˆí˜¸
     * URLì—ì„œ ì¶”ì¶œ: https://docs.google.com/spreadsheets/d/[ì´ ë¶€ë¶„]/edit
     */
    private final String spreadsheetId;

    /**
     * ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë‚´ì˜ íŠ¹ì • ì‹œíŠ¸(íƒ­) ì´ë¦„
     * ì˜ˆ: "checklist", "smoke_test", "regression_test"
     */
    private final String sheetName;

    /**
     * í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê¸°ë¡í•  ì»¬ëŸ¼ (G = 7ë²ˆì§¸ ì»¬ëŸ¼)
     *
     * ì™œ G ì»¬ëŸ¼ì¸ê°€ìš”?
     * - A~F: TC ë²ˆí˜¸, í…ŒìŠ¤íŠ¸ëª…, ìš°ì„ ìˆœìœ„, ë‹´ë‹¹ì, ìƒíƒœ ë“± ì •ë³´
     * - G: ìë™í™” í…ŒìŠ¤íŠ¸ ê²°ê³¼ (Pass/Fail/Block)
     *
     * ë³€ê²½ì´ í•„ìš”í•œ ê²½ìš°:
     * - ì‹œíŠ¸ êµ¬ì¡°ê°€ ë°”ë€Œì–´ ê²°ê³¼ ì»¬ëŸ¼ì´ Hë¡œ ì´ë™ â†’ "H"ë¡œ ë³€ê²½
     */
    private static final String RESULT_COLUMN = "G";

    /**
     * ë°ì´í„° ì‹œì‘ ì „ í—¤ë” í–‰ ìˆ˜
     *
     * í˜„ì¬ êµ¬ì¡°:
     * - 1í–‰: ì œëª© ("í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸")
     * - 2í–‰: ì»¬ëŸ¼ í—¤ë” ("TC No", "í…ŒìŠ¤íŠ¸ëª…", ...)
     * - 3í–‰ë¶€í„°: ì‹¤ì œ ë°ì´í„°
     *
     * ë”°ë¼ì„œ ì‹¤ì œ ê³„ì‚°ì—ì„œëŠ” tcNo + 2 ì‚¬ìš©
     * (ì œëª© 1í–‰ + í—¤ë” 1í–‰ = 2í–‰ í›„ ë°ì´í„° ì‹œì‘)
     */
    private static final int HEADER_ROWS = 3;

    /**
     * ChecklistReporter ì´ˆê¸°í™” (êµ¬ê¸€ ì‹œíŠ¸ ì—°ê²° ì •ë³´ ì„¤ì •)
     *
     * ì´ ìƒì„±ìëŠ” BaseTestCaseì˜ setUp()ì—ì„œ í˜¸ì¶œë©ë‹ˆë‹¤.
     *
     * @param sheets êµ¬ê¸€ ì‹œíŠ¸ API ì„œë¹„ìŠ¤ (GoogleSheetsClientì—ì„œ ìƒì„±)
     * @param spreadsheetId ëŒ€ìƒ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID
     * @param sheetName ëŒ€ìƒ ì‹œíŠ¸(íƒ­) ì´ë¦„
     */
    public ChecklistReporter(Sheets sheets, String spreadsheetId, String sheetName) {
        this.sheets = sheets;
        this.spreadsheetId = spreadsheetId;
        this.sheetName = sheetName;
    }

    /**
     * í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ê²°ê³¼ë¥¼ êµ¬ê¸€ ì‹œíŠ¸ì— ìë™ ê¸°ë¡ (í•µì‹¬ ë©”ì„œë“œ)
     *
     * TC ë²ˆí˜¸ë§Œ ì•Œë ¤ì£¼ë©´ í•´ë‹¹í•˜ëŠ” ì…€ ìœ„ì¹˜ë¥¼ ìë™ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ê²°ê³¼ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.
     *
     * ğŸ¯ ë™ì‘ ê³¼ì •:
     * 1. TC ë²ˆí˜¸ë¡œ í–‰ ë²ˆí˜¸ ê³„ì‚° (tcNo + 2)
     * 2. ì»¬ëŸ¼(G)ê³¼ í–‰ ë²ˆí˜¸ë¥¼ ì¡°í•©í•˜ì—¬ ì…€ ì£¼ì†Œ ìƒì„± (ì˜ˆ: G3)
     * 3. ì‹œíŠ¸ëª…ê³¼ ì…€ ì£¼ì†Œë¥¼ ì¡°í•©í•˜ì—¬ ì „ì²´ ë²”ìœ„ ì§€ì • (ì˜ˆ: checklist!G3)
     * 4. êµ¬ê¸€ ì‹œíŠ¸ APIë¡œ í•´ë‹¹ ì…€ì— ê²°ê³¼ ê¸°ë¡
     *
     * ğŸ“ ì…€ ì£¼ì†Œ ê³„ì‚° ì˜ˆì‹œ:
     * ```
     * TC01 (tcNo=1):
     *   rowNumber = 1 + 2 = 3
     *   cellAddress = G3
     *   range = checklist!G3
     *
     * TC02 (tcNo=2):
     *   rowNumber = 2 + 2 = 4
     *   cellAddress = G4
     *   range = checklist!G4
     * ```
     *
     * ğŸ’¡ ì‹¤ì „ í™œìš© ì˜ˆì‹œ:
     * ```java
     * // BaseTestCaseì—ì„œ ìë™ í˜¸ì¶œ
     * boolean appStarted = StartAppFlow.run(driver);
     * recordResult(1, "AppStart", appStarted);
     * // â†’ ë‚´ë¶€ì ìœ¼ë¡œ reporter.writeTCResult(1, "Pass") í˜¸ì¶œ
     * // â†’ êµ¬ê¸€ ì‹œíŠ¸ G3 ì…€ì— "Pass" ê¸°ë¡
     * ```
     *
     * âš ï¸ ì£¼ì˜ì‚¬í•­:
     * - ë„¤íŠ¸ì›Œí¬ ì—°ê²° í•„ìˆ˜ (êµ¬ê¸€ API í˜¸ì¶œ)
     * - Service Accountì— í•´ë‹¹ ì‹œíŠ¸ í¸ì§‘ ê¶Œí•œ í•„ìš”
     * - ì‹œíŠ¸ êµ¬ì¡°ì™€ HEADER_ROWS ì„¤ì •ì´ ì¼ì¹˜í•´ì•¼ í•¨
     *
     * @param tcNo í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë²ˆí˜¸ (1ë¶€í„° ì‹œì‘: TC01=1, TC02=2, ...)
     * @param result í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¬¸ìì—´ ("Pass", "Fail", "Block")
     * @throws Exception êµ¬ê¸€ ì‹œíŠ¸ API í˜¸ì¶œ ì‹¤íŒ¨, ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, ê¶Œí•œ ë¶€ì¡± ë“±
     */
    public void writeTCResult(int tcNo, String result) throws Exception {
        // [STEP 1] ì…€ ì£¼ì†Œ ë™ì  ê³„ì‚°
        // TC01(1) â†’ 3í–‰, TC02(2) â†’ 4í–‰ (ì œëª© + í—¤ë” 2í–‰ í›„ ë°ì´í„° ì‹œì‘)
        int rowNumber = tcNo + (HEADER_ROWS - 1);

        // [STEP 2] ì»¬ëŸ¼ê³¼ í–‰ ë²ˆí˜¸ ì¡°í•© (ì˜ˆ: G3, G4, G101)
        String cellAddress = RESULT_COLUMN + rowNumber;

        // [STEP 3] ì‹œíŠ¸ëª… í¬í•¨ ì „ì²´ ë²”ìœ„ ì§€ì • (ì˜ˆ: checklist!G3)
        String range = sheetName + "!" + cellAddress;

        // [STEP 4] ê¸°ë¡í•  ë°ì´í„° ì¤€ë¹„
        ValueRange body = new ValueRange().setValues(List.of(List.of(result)));

        // [STEP 5] êµ¬ê¸€ ì‹œíŠ¸ APIë¡œ ì‹¤ì œ ê¸°ë¡ ì‹¤í–‰
        sheets.spreadsheets().values()
                .update(spreadsheetId, range, body)
                .setValueInputOption("RAW")
                .execute();

        // [LOG] ê¸°ë¡ ì™„ë£Œ ì•Œë¦¼
        System.out.println("[Report] TC" + String.format("%02d", tcNo) +
                " â†’ " + cellAddress + " ê¸°ë¡ ì™„ë£Œ: " + result);
    }

    /**
     * ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ í•œ ë²ˆì— ì¼ê´„ ê¸°ë¡ (ë°°ì¹˜ ì²˜ë¦¬)
     *
     * @param results TC ë²ˆí˜¸ì™€ ê²°ê³¼ ë§µ (ì˜ˆ: {1: "Pass", 2: "Fail", 3: "Block"})
     * @throws Exception êµ¬ê¸€ ì‹œíŠ¸ API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ
     */
    public void writeBatchResults(java.util.Map<Integer, String> results) throws Exception {
        for (var entry : results.entrySet()) {
            writeTCResult(entry.getKey(), entry.getValue());
        }
    }

    // ========================================
    // ğŸ“¦ ë ˆê±°ì‹œ ë©”ì„œë“œ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
    // ========================================

    /**
     * @deprecated writeTCResult(1, result) ì‚¬ìš© ê¶Œì¥
     */
    public void writeTC01Result(String result) throws Exception {
        writeTCResult(1, result);
    }

    /**
     * @deprecated writeTCResult(2, result) ì‚¬ìš© ê¶Œì¥
     */
    public void writeTC02Result(String result) throws Exception {
        writeTCResult(2, result);
    }
}
